<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Short URL • Pramuka Punggelan</title>
<link rel="icon" href="assets/images/logologo.png" type="image/png">
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
<link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
<style>
/* (CSS tetap sama seperti versi kamu, aku skip di sini untuk ringkas) */
</style>
</head>
<body>
<header>
  <div class="nav-container">
    <div class="brand">
      <img src="assets/images/logodkr.png" alt="Logo DKR">
      <h1>Short URL</h1>
    </div>
  </div>
</header>

<div class="container">
  <div class="headeri">
    <h1>Short URL Generator</h1>
    <p>Masukkan link asli dan buat versi pendeknya</p>
  </div>

  <div class="card form-box">
    <input type="text" id="originalURL" placeholder="Masukkan URL panjang di sini" style="width:100%;margin-bottom:12px;">
    <input type="text" id="shortCode" placeholder="Masukkan shortcode unik" style="width:100%;margin-bottom:12px;">
    <button class="btn-purple" onclick="createShortURL()">Buat Short URL</button>
    <p id="result" style="margin-top:12px;"></p>
  </div>

  <div class="card">
    <h3>Daftar Short URL</h3>
    <table class="table" id="urlList">
      <thead>
        <tr>
          <th>Short Code</th>
          <th>Original URL</th>
          <th>Created At</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</div>

<footer>
  <div class="credits">© 2026 Pramuka Punggelan Short URL</div>
</footer>

<script>
async function createShortURL(){
  const longURL = document.getElementById("originalURL").value.trim();
  const shortCode = document.getElementById("shortCode").value.trim();

  if(!longURL || !shortCode){
    alert("Masukkan URL dan shortcode!");
    return;
  }

  try{
    const res = await fetch(`/api/create`, {
      method:"POST",
      headers:{ "Content-Type": "application/json" },
      body: JSON.stringify({ url: longURL, short: shortCode })
    });
    const text = await res.text();
    if(text === "OK"){
      document.getElementById("result").innerHTML = `
        Short URL: <a href="/${shortCode}" target="_blank">https://pramukapunggelan.vercel.app/${shortCode}</a>
      `;
      loadURLList();
    } else {
      alert(text);
    }
  } catch(e){
    alert("Terjadi error: "+e.message);
  }
}

async function loadURLList(){
  const res = await fetch(`/api/list`);
  const data = await res.json();
  const tbody = document.querySelector("#urlList tbody");
  tbody.innerHTML = "";
  data.forEach(row=>{
    const tr = document.createElement("tr");
    tr.innerHTML = `<td>${row.short}</td><td><a href="${row.url}" target="_blank">${row.url}</a></td><td>${new Date(row.created).toLocaleString()}</td>`;
    tbody.appendChild(tr);
  });
}

// Load daftar saat halaman dibuka
loadURLList();
</script>
</body>
</html>
